{% extends "base.html" %}
{% block content %}

<h1>BlocklyでGASを組み立てよう</h1>
<div class="row">
    <div class="col-md-8">

        <!-- Blocklyを最新にしてくれるやつ -->
        <script src="https://unpkg.com/blockly/blockly.min.js"></script>
        <!-- Blocklyのライブラリ -->
        <script src="/static/js/blockly_compressed.js"></script>
        <script src="/static/js/blocks_compressed.js"></script>
        <script src="/static/js/block_list.js"></script>
        <script src="/static/js/javascript_compressed.js"></script>
        <script src="/static/js/ja.js"></script>
        <!-- 自作ブロックの定義 -->
        <script src="/static/js/myblock.js"></script>
        <!-- ワークスペースのエリア -->
        <div id="blocklyDiv" style="height: 600px; width: 1000px;"></div>
        <button onclick="doCode()">コードの実行</button>
        <!-- ツールボックスの定義 -->
        <xml id="toolbox">
            <category name="スプレッドシート操作" color="210">
                <block type="function_name"></block>
                <block type="get_info"></block>
                <block type="getrange"></block>
                <block type="setValue"></block>
                <block type="program_run"></block>
                <block type="logic_sample"></block>
                <block type="logic_sample2"></block>
                <block type="get_last_low"></block>
            </category>
            <category name="数値" color="#6B7CD3">
                <block type="getrange_int"></block>
                <block type="loop_counts"></block>
                <block type="last_low_variable"></block>
            </category>
            <category name="論理" color="#6B7CD3">
                <block type="controls_if"></block>
                <block type="logic_compare"></block>
                <block type="calculate"></block>
            </category>
            <category name="繰り返し" color="#6B7CD3">
                <block type="controls_repeat_ext"></block>
            </category>
            <category name="時間データ" color="#6B7CD3">
                <block type="get_date"></block>
                <block type="hours"></block>
                <block type="min"></block>
                <block type="day"></block>
                <block type="month"></block>
                <block type="week"></block>
            </category>
            <category name = "変数">
                <block type="block_input"></block>
                <block type="string_variable"></block>
                <block type="min_variable"></block>
                <block type="day_variable"></block>
                <block type="month_variable"></block>
                <block type="week_variable"></block>
            </category>




            <script>
                //Blocklyをdivにはめ込み
                var workspace = Blockly.inject('blocklyDiv',
                    { toolbox: document.getElementById('toolbox') });

                function doCode() {
                    //ブロックからプログラム（文字列）を作成
                    var code = Blockly.JavaScript.workspaceToCode(workspace);
                    //プログラムを実行
                    try {
                        eval(code);

                    }
                    catch (e) {
                        alert(e);
                    }
                }
            </script>

            <div class="card w-75">
                <div class="card-body">
                    <h5 class="card-title">GoogleAppScripts</h5>
                    <p class="card-text">
                    <div id="output"></div>
                    <script src="/static/js/myblock.js"></script>
                    </p>
                    <button type="button" class="btn btn-primary">Button</button>
                </div>
            </div>
    </div>
</div>


{% endblock %}